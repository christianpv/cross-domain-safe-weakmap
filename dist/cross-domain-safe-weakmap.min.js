!function(e,r){"object"==typeof exports&&"object"==typeof module?module.exports=r():"function"==typeof define&&define.amd?define("xdsweakmap",[],r):"object"==typeof exports?exports.xdsweakmap=r():e.xdsweakmap=r()}(this,function(){return function(e){function r(n){if(t[n])return t[n].exports;var i=t[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,r),i.loaded=!0,i.exports}var t={};return r.m=e,r.c=t,r.p="",r(0)}([function(e,r,t){"use strict";function n(e){if(e&&e.__esModule)return e;var r={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(r[t]=e[t]);return r.default=e,r}Object.defineProperty(r,"__esModule",{value:!0});var i=t(1);Object.keys(i).forEach(function(e){"default"!==e&&"__esModule"!==e&&Object.defineProperty(r,e,{enumerable:!0,get:function(){return i[e]}})});var a=n(i);r.default=a},function(e,r,t){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=t(2);Object.defineProperty(r,"WeakMap",{enumerable:!0,get:function(){return n.CrossDomainSafeWeakMap}})},function(e,r,t){"use strict";function n(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function i(){}Object.defineProperty(r,"__esModule",{value:!0}),r.CrossDomainSafeWeakMap=void 0;var a=function(){function e(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(r,t,n){return t&&e(r.prototype,t),n&&e(r,n),r}}(),o=t(3),u=t(5),f=Object.defineProperty,c=Date.now()%1e9;r.CrossDomainSafeWeakMap=function(){function e(){if(n(this,e),c+=1,this.name="__weakmap_"+(1e9*Math.random()>>>0)+"__"+c,(0,u.hasNativeWeakMap)())try{this.weakmap=new window.WeakMap}catch(e){}this.keys=[],this.values=[]}return a(e,[{key:"_cleanupClosedWindows",value:function(){for(var e=this.weakmap,r=this.keys,t=0;t<r.length;t++){var n=r[t];if((0,o.isWindowClosed)(n)){if(e)try{e.delete(n)}catch(e){}r.splice(t,1),this.values.splice(t,1),t-=1}}}},{key:"isSafeToReadWrite",value:function(e){if((0,o.isWindow)(e))return!1;try{i(e&&e.self),i(e&&e[this.name])}catch(e){return!1}return!0}},{key:"set",value:function(e,r){if(!e)throw new Error("WeakMap expected key");var t=this.weakmap;if(t)try{t.set(e,r)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var n=this.name,i=e[n];i&&i[0]===e?i[1]=r:f(e,n,{value:[e,r],writable:!0})}else{this._cleanupClosedWindows();var a=this.keys,o=this.values,u=a.indexOf(e);u===-1?(a.push(e),o.push(r)):o[u]=r}}},{key:"get",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{if(r.has(e))return r.get(e)}catch(e){delete this.weakmap}if(!this.isSafeToReadWrite(e)){var t=this.keys,n=t.indexOf(e);if(n===-1)return;return this.values[n]}var i=e[this.name];if(i&&i[0]===e)return i[1]}},{key:"delete",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{r.delete(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var t=e[this.name];t&&t[0]===e&&(t[0]=t[1]=void 0)}else{this._cleanupClosedWindows();var n=this.keys,i=n.indexOf(e);i!==-1&&(n.splice(i,1),this.values.splice(i,1))}}},{key:"has",value:function(e){if(!e)throw new Error("WeakMap expected key");var r=this.weakmap;if(r)try{return r.has(e)}catch(e){delete this.weakmap}if(this.isSafeToReadWrite(e)){var t=e[this.name];return!(!t||t[0]!==e)}return this._cleanupClosedWindows(),this.keys.indexOf(e)!==-1}}]),e}()},function(e,r,t){"use strict";function n(e){var r=e.location;if(!r)throw new Error("Can not read window location");var t=r.protocol;if(!t)throw new Error("Can not read window protocol");if(t===J.FILE_PROTOCOL)return"file://";var n=r.host;if(!n)throw new Error("Can not read window host");return t+"//"+n}function i(e){e=e||window;var r=n(e);return r&&e.mockDomain&&0===e.mockDomain.indexOf(J.MOCK_PROTOCOL)?e.mockDomain:r}function a(e){try{if(!e.location.href)return!0;if("about:blank"===e.location.href)return!0}catch(e){}return!1}function o(e){try{var r=Object.getOwnPropertyDescriptor(e,"location");if(r&&r.enumerable===!1)return!1}catch(e){}try{if(a(e))return!0;if(n(e)===n(window))return!0}catch(e){}return!1}function u(e){if(!o(e))return!1;try{if(a(e))return!0;if(i(window)===i(e))return!0}catch(e){}return!1}function f(e){if(e)try{if(e.parent&&e.parent!==e)return e.parent}catch(e){return}}function c(e){if(e&&!f(e))try{return e.opener}catch(e){return}}function s(e){var r=[];try{for(;e.parent!==e;)r.push(e.parent),e=e.parent}catch(e){}return r}function l(e,r){if(!e||!r)return!1;var t=f(r);return t?t===e:s(r).indexOf(e)!==-1}function d(e){var r=[],t=void 0;try{t=e.frames}catch(r){t=e}var n=void 0;try{n=t.length}catch(e){}if(0===n)return r;if(n){for(var i=0;i<n;i++){var a=void 0;try{a=t[i]}catch(e){continue}r.push(a)}return r}for(var o=0;o<100;o++){var u=void 0;try{u=t[o]}catch(e){return r}if(!u)return r;r.push(u)}return r}function v(e){for(var r=[],t=d(e),n=Array.isArray(t),i=0,t=n?t:t[Symbol.iterator]();;){var a;if(n){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var o=a;r.push(o);for(var u=v(o),f=Array.isArray(u),c=0,u=f?u:u[Symbol.iterator]();;){var s;if(f){if(c>=u.length)break;s=u[c++]}else{if(c=u.next(),c.done)break;s=c.value}var l=s;r.push(l)}}return r}function h(e){var r=v(e);r.push(e);for(var t=s(e),n=Array.isArray(t),i=0,t=n?t:t[Symbol.iterator]();;){var a;if(n){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}var o=a;r.push(o);for(var u=d(o),f=Array.isArray(u),c=0,u=f?u:u[Symbol.iterator]();;){var l;if(f){if(c>=u.length)break;l=u[c++]}else{if(c=u.next(),c.done)break;l=c.value}var h=l;r.indexOf(h)===-1&&r.push(h)}}return r}function y(e){if(e){try{if(e.top)return e.top}catch(e){}if(f(e)===e)return e;try{if(l(window,e))return window.top}catch(e){}try{if(l(e,window))return window.top}catch(e){}for(var r=v(e),t=Array.isArray(r),n=0,r=t?r:r[Symbol.iterator]();;){var i;if(t){if(n>=r.length)break;i=r[n++]}else{if(n=r.next(),n.done)break;i=n.value}var a=i;try{if(a.top)return a.top}catch(e){}if(f(a)===a)return a}}}function p(e){return e===y(e)}function w(e){if(!e.contentWindow)return!0;if(!e.parentNode)return!0;var r=e.ownerDocument;return!(!r||!r.body||r.body.contains(e))}function m(e){var r=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];try{if(e===window)return!1}catch(e){return!0}try{if(!e)return!0}catch(e){return!0}try{if(e.closed)return!0}catch(e){return!e||"Call was rejected by callee.\r\n"!==e.message}if(r&&u(e))try{if(e.mockclosed)return!0}catch(e){}try{if(!e.parent||!e.top)return!0}catch(e){}try{var t=K.indexOf(e);if(t!==-1){var n=q[t];if(n&&w(n))return!0}}catch(e){}return!1}function k(){for(var e=0;e<q.length;e++)w(q[e])&&(q.splice(e,1),K.splice(e,1));for(var r=0;r<K.length;r++)m(K[r])&&(q.splice(r,1),K.splice(r,1))}function b(e){if(k(),e&&e.contentWindow)try{K.push(e.contentWindow),q.push(e)}catch(e){}}function g(e){return e=e||window,e.navigator.mockUserAgent||e.navigator.userAgent}function O(e,r){for(var t=d(e),n=t,i=Array.isArray(n),a=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(a>=n.length)break;o=n[a++]}else{if(a=n.next(),a.done)break;o=a.value}var f=o;try{if(u(f)&&f.name===r&&t.indexOf(f)!==-1)return f}catch(e){}}try{if(t.indexOf(e.frames[r])!==-1)return e.frames[r]}catch(e){}try{if(t.indexOf(e[r])!==-1)return e[r]}catch(e){}}function x(e,r){var t=O(e,r);if(t)return t;for(var n=d(e),i=Array.isArray(n),a=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(a>=n.length)break;o=n[a++]}else{if(a=n.next(),a.done)break;o=a.value}var u=o,f=x(u,r);if(f)return f}}function A(e,r){var t=void 0;return t=O(e,r),t?t:x(y(e),r)}function W(e,r){var t=f(r);if(t)return t===e;for(var n=d(e),i=Array.isArray(n),a=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(a>=n.length)break;o=n[a++]}else{if(a=n.next(),a.done)break;o=a.value}var u=o;if(u===r)return!0}return!1}function _(e,r){return e===c(r)}function S(e){e=e||window;var r=c(e);if(r)return r;var t=f(e);return t?t:void 0}function C(e){for(var r=[],t=e;t;)t=S(t),t&&r.push(t);return r}function M(e,r){var t=S(r);if(t)return t===e;if(r===e)return!1;if(y(r)===r)return!1;for(var n=d(e),i=Array.isArray(n),a=0,n=i?n:n[Symbol.iterator]();;){var o;if(i){if(a>=n.length)break;o=n[a++]}else{if(a=n.next(),a.done)break;o=a.value}var u=o;if(u===r)return!0}return!1}function P(){return Boolean(c(window))}function j(){return Boolean(f(window))}function D(){return Boolean(!j()&&!P())}function T(e,r){for(var t=e,n=Array.isArray(t),i=0,t=n?t:t[Symbol.iterator]();;){var a;if(n){if(i>=t.length)break;a=t[i++]}else{if(i=t.next(),i.done)break;a=i.value}for(var o=a,u=r,f=Array.isArray(u),c=0,u=f?u:u[Symbol.iterator]();;){var s;if(f){if(c>=u.length)break;s=u[c++]}else{if(c=u.next(),c.done)break;s=c.value}var l=s;if(o===l)return!0}}}function R(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:window,r=0;e;)e=f(e),e&&(r+=1);return r}function F(e){for(var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,t=0;t<r;t++)e=f(e);return e}function E(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return F(e,R(e)-r)}function N(e,r){var t=y(e),n=y(r);try{if(t&&n)return t===n}catch(e){}var i=h(e),a=h(r);if(T(i,a))return!0;var o=c(t),u=c(n);return(!o||!T(h(o),a))&&((!u||!T(h(u),i))&&void 0)}function B(e,r){if("string"==typeof e){if("string"==typeof r)return e===J.WILDCARD||r===e;if((0,z.isRegex)(r))return!1;if(Array.isArray(r))return!1}return(0,z.isRegex)(e)?(0,z.isRegex)(r)?e.toString()===r.toString():!Array.isArray(r)&&Boolean(r.match(e)):!!Array.isArray(e)&&(Array.isArray(r)?JSON.stringify(e)===JSON.stringify(r):!(0,z.isRegex)(r)&&e.some(function(e){return B(e,r)}))}function L(e){var r=void 0;return e.match(/^(https?|mock|file):\/\//)?(r=e,r=r.split("/").slice(0,3).join("/")):i()}function I(e,r){var t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,i=void 0,a=function a(){return m(e)?(i&&clearTimeout(i),r()):void(n<=0?clearTimeout(i):(n-=t,i=setTimeout(a,t)))};return a(),{cancel:function(){i&&clearTimeout(i)}}}function U(e){try{if(e&&e.self===e)return!0}catch(e){}return!1}Object.defineProperty(r,"__esModule",{value:!0}),r.getActualDomain=n,r.getDomain=i,r.isBlankDomain=a,r.isActuallySameDomain=o,r.isSameDomain=u,r.getParent=f,r.getOpener=c,r.getParents=s,r.isAncestorParent=l,r.getFrames=d,r.getAllChildFrames=v,r.getAllFramesInWindow=h,r.getTop=y,r.isTop=p,r.isFrameWindowClosed=w,r.isWindowClosed=m,r.linkFrameWindow=b,r.getUserAgent=g,r.getFrameByName=O,r.findChildFrameByName=x,r.findFrameByName=A,r.isParent=W,r.isOpener=_,r.getAncestor=S,r.getAncestors=C,r.isAncestor=M,r.isPopup=P,r.isIframe=j,r.isFullpage=D,r.getDistanceFromTop=R,r.getNthParent=F,r.getNthParentFromTop=E,r.isSameTopWindow=N,r.matchDomain=B,r.getDomainFromUrl=L,r.onCloseWindow=I,r.isWindow=U;var z=t(4),J={MOCK_PROTOCOL:"mock:",FILE_PROTOCOL:"file:",WILDCARD:"*"},K=[],q=[]},function(e,r){"use strict";function t(e){return"[object RegExp]"===Object.prototype.toString.call(e)}Object.defineProperty(r,"__esModule",{value:!0}),r.isRegex=t},function(e,r){"use strict";function t(){if(!window.WeakMap)return!1;if(!window.Object.freeze)return!1;try{var e=new window.WeakMap,r={},t="__testvalue__";return window.Object.freeze(r),e.set(r,t),e.get(r)===t}catch(e){return!1}}Object.defineProperty(r,"__esModule",{value:!0}),r.hasNativeWeakMap=t}])});
//# sourceMappingURL=cross-domain-safe-weakmap.min.js.map